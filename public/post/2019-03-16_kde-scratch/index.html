<!DOCTYPE html>
<html lang="en-us">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.1.0">
  <meta name="generator" content="Hugo 0.54.0" />

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Josh Duncan">

  
  
  
    
  
  <meta name="description" content="Motivation Why am I writing about KDE&rsquo;s? At the recommendation of Will Kurt&rsquo;s probability blog I&rsquo;ve been reading a great book by Phillip K. Jannert:
This book has a great overview of KDE&rsquo;s that explain the motivation. My own abbreviated version is that KDE&rsquo;s are a visualization technique to view a variables distribution. It&rsquo;s best to visualize a variable prior to calculating measures of central tendency (means/modes/medians) and other statistics like variance and standard deviation.">

  
  <link rel="alternate" hreflang="en-us" href="/post/2019-03-16_kde-scratch/">

  


  

  

  

  

  

  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha256-eSi1q2PG6J7g7ib17yAaWMcrr5GrtohYChqibrV7PBE=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.0/css/all.css" integrity="sha384-aOkxzJ5uQz7WBObEZcHvV5JvRW3TUc2rNPA7pe3AwnsUohiw1Vj2Rgx2KSOkF5+h" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" integrity="sha256-ygkqlh3CYSUri3LhQxzdcm0n1EQvH2Y+U5S2idbLtxs=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" crossorigin="anonymous">
      
    

    

    

  

  
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Montserrat:400,700|Roboto:400,400italic,700|Roboto+Mono">
  

  <link rel="stylesheet" href="/styles.css">
  

  
  
  

  
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="Josh Duncan">
  <link rel="feed" href="/index.xml" type="application/rss+xml" title="Josh Duncan">
  

  <link rel="manifest" href="/site.webmanifest">
  <link rel="icon" type="image/png" href="/img/icon.png">
  <link rel="apple-touch-icon" type="image/png" href="/img/icon-192.png">

  <link rel="canonical" href="/post/2019-03-16_kde-scratch/">

  
  
  
  
    
    
  
  <meta property="twitter:card" content="summary">
  
  <meta property="og:site_name" content="Josh Duncan">
  <meta property="og:url" content="/post/2019-03-16_kde-scratch/">
  <meta property="og:title" content="Kernel Density Estimation from Scratch | Josh Duncan">
  <meta property="og:description" content="Motivation Why am I writing about KDE&rsquo;s? At the recommendation of Will Kurt&rsquo;s probability blog I&rsquo;ve been reading a great book by Phillip K. Jannert:
This book has a great overview of KDE&rsquo;s that explain the motivation. My own abbreviated version is that KDE&rsquo;s are a visualization technique to view a variables distribution. It&rsquo;s best to visualize a variable prior to calculating measures of central tendency (means/modes/medians) and other statistics like variance and standard deviation."><meta property="og:image" content="/img/icon-192.png">
  <meta property="og:locale" content="en-us">
  
  <meta property="article:published_time" content="2019-03-16T00:00:00-05:00">
  
  <meta property="article:modified_time" content="2019-03-16T00:00:00-05:00">
  

  

  

  <title>Kernel Density Estimation from Scratch | Josh Duncan</title>

</head>
<body id="top" data-spy="scroll" data-target="#TableOfContents" data-offset="71" >
  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" role="textbox" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


<nav class="navbar navbar-light fixed-top navbar-expand-lg py-0" id="navbar-main">
  <div class="container">

    
      <a class="navbar-brand" href="/">Josh Duncan</a>
      
      <button type="button" class="navbar-toggler" data-toggle="collapse"
              data-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
        <span><i class="fas fa-bars"></i></span>
      </button>
      

    
    <div class="collapse navbar-collapse" id="navbar">

      
      
      <ul class="navbar-nav mr-auto">
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#about">
            
            <span>Home</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#posts">
            
            <span>Blog</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/bio/">
            
            <span>Bio</span>
            
          </a>
        </li>

        
        

        

        
        
        
          
        

        <li class="nav-item">
          <a class="nav-link" href="/#contact">
            
            <span>Contact</span>
            
          </a>
        </li>

        
        

      
      </ul>
      <ul class="navbar-nav ml-auto">
      

        

        
        <li class="nav-item">
          <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
        </li>
        

        

        

      </ul>

    </div>
  </div>
</nav>


<article class="article" itemscope itemtype="http://schema.org/Article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1 itemprop="name">Kernel Density Estimation from Scratch</h1>

  

  
    



<meta content="2019-03-16 00:00:00 -0500 CDT" itemprop="datePublished">
<meta content="2019-03-16 00:00:00 -0500 CDT" itemprop="dateModified">

<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    <time>Mar 16, 2019</time>
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    4 min read
  </span>
  

  
  

  

  
    
<div class="share-box" aria-hidden="true">
  <ul class="share">
    <li>
      <a class="twitter"
         href="https://twitter.com/intent/tweet?text=Kernel%20Density%20Estimation%20from%20Scratch&amp;url=%2fpost%2f2019-03-16_kde-scratch%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
    <li>
      <a class="facebook"
         href="https://www.facebook.com/sharer.php?u=%2fpost%2f2019-03-16_kde-scratch%2f"
         target="_blank" rel="noopener">
        <i class="fab fa-facebook-f"></i>
      </a>
    </li>
    <li>
      <a class="linkedin"
         href="https://www.linkedin.com/shareArticle?mini=true&amp;url=%2fpost%2f2019-03-16_kde-scratch%2f&amp;title=Kernel%20Density%20Estimation%20from%20Scratch"
         target="_blank" rel="noopener">
        <i class="fab fa-linkedin-in"></i>
      </a>
    </li>
    <li>
      <a class="weibo"
         href="http://service.weibo.com/share/share.php?url=%2fpost%2f2019-03-16_kde-scratch%2f&amp;title=Kernel%20Density%20Estimation%20from%20Scratch"
         target="_blank" rel="noopener">
        <i class="fab fa-weibo"></i>
      </a>
    </li>
    <li>
      <a class="email"
         href="mailto:?subject=Kernel%20Density%20Estimation%20from%20Scratch&amp;body=%2fpost%2f2019-03-16_kde-scratch%2f">
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  </ul>
</div>


  

</div>

    















  
</div>



  <div class="article-container">

    <div class="article-style" itemprop="articleBody">
      

<h2 id="motivation">Motivation</h2>

<p>Why am I writing about KDE&rsquo;s? At the recommendation of Will Kurt&rsquo;s <a href="https://www.countbayesie.com/" target="_blank">probability blog</a> I&rsquo;ve been reading a great book by Phillip K. Jannert:</p>

<p><img src="/post/2019-03-16-kde-scratch_files/janert.jpg" alt="drawing" width="50%"/></p>

<p>This book has a great overview of KDE&rsquo;s that explain the motivation. My own abbreviated version is that KDE&rsquo;s are a visualization technique to view a variables distribution. It&rsquo;s best to visualize a variable prior to calculating measures of central tendency (means/modes/medians) and other statistics like variance and standard deviation. It&rsquo;s important because these measures are assuming that your data is <code>unimodal</code> (having a single peak). If your data doesn&rsquo;t have this structure then these measures may be misleading.</p>

<p>This post follows closely with how I commonly learn about topics. I start at a high level, using a pre-canned solution for the algorithm, and then work backward to find out what&rsquo;s going on underneath.</p>

<p>I use a small example I discovered on the <a href="https://en.wikipedia.org/wiki/Kernel_density_estimation" target="_blank">Wikipedia page</a>) for KDEs. It uses a handful of data points for a single variable:</p>

<table>
<thead>
<tr>
<th>Sample</th>
<th>Value</th>
</tr>
</thead>

<tbody>
<tr>
<td>1</td>
<td>-2.1</td>
</tr>

<tr>
<td>2</td>
<td>-1.3</td>
</tr>

<tr>
<td>3</td>
<td>-0.4</td>
</tr>

<tr>
<td>4</td>
<td>1.9</td>
</tr>

<tr>
<td>5</td>
<td>5.1</td>
</tr>

<tr>
<td>6</td>
<td>6.2</td>
</tr>
</tbody>
</table>

<p>I&rsquo;ll be using the <code>Julia Programming Language</code> for this example. Let&rsquo;s start with a basic <code>dot</code> plot of these points.</p>

<pre><code class="language-julia">using StatsPlots

# initialize an array of the samples
x = [-2.1; -1.3; -0.4; 1.9; 5.1; 6.2];
# plot it out
scatter(x, zeros(length(x)), legend = false)
</code></pre>

<p><img src="/post/2019-03-16-kde-scratch_files/2019-03-16_kde-scratch_1_1.svg" alt="" /></p>

<h2 id="kde-with-kerneldensity-jl">KDE with KernelDensity.jl</h2>

<p>Now applying the quick and easy solution: a <a href="https://github.com/JuliaStats/KernelDensity.jl" target="_blank">package</a>. This package has a function named <code>kde</code> that takes a one dimensional array (or vector), a bandwidth argument, and a chosen kernel (we&rsquo;ll use the default). So let&rsquo;s see it:</p>

<pre><code class="language-julia">import KernelDensity

KernelDensity.kde(x, bandwidth = sqrt(2.25)) |&gt;
  x -&gt; plot!(x, legend = false)
</code></pre>

<p><img src="/post/2019-03-16-kde-scratch_files/2019-03-16_kde-scratch_2_1.svg" alt="" /></p>

<p>There we go, we&rsquo;ve applied KDE to these data points and we can see the <code>bimodal</code> nature of this data. We could stop here but let&rsquo;s keep going.</p>

<h2 id="kde-with-distributions-jl">KDE with Distributions.jl</h2>

<p>What is the <code>kernel</code> part of this about? The <code>kde</code> function from the package uses a default <code>kernel</code> associated with the <code>Normal</code> distribution. But to understand what this all means we need to take a look at the definition of Kernel Density Estimation:</p>

<p><code>$$
D_h(x; {x_i}) = \sum_{i=1}^n \frac{1}{h} K(\frac{x - x_i}{h})
$$</code></p>

<p>Breaking down this formula a bit: The <code>kernel</code> is the function shown above as <code>$K$</code>. Jannert describes it as a &ldquo;highly&rdquo; peaked function. For every point along the x-axis we take the distance between that point and an individual data point from our example. That set of distances are fed into the kernel function. Then the results of these evaluations for each individual data point are summed together and divided by the number of observations of our variable.</p>

<p>There is a great demonstration of how kernel functions work <a href="https://mathisonian.github.io/kde/" target="_blank">here</a>. It is a very elegant and interactive interface where you can test different bandwidths/kernels and see the results of the KDE.</p>

<p>As I mentioned before, the default <code>kernel</code> for this package is the <code>Normal</code> (or Gaussian) probability density function (pdf):</p>

<p><code>$$
K(x) = \frac{1}{\sqrt{2\pi}}\text{exp}(-\frac{1}{2}x^2)
$$</code></p>

<p>We can get an idea of what the KDE should look like by using the <a href="https://github.com/JuliaStats/Distributions.jl" target="_blank">Distributions.jl</a> package. We can create individual normal distributions for each data point and then calculate the <code>pdf</code> of each distribution across the x-axis and sum these results.</p>

<pre><code class="language-julia">using Distributions

dists = Normal.(x, sqrt(2.25))
</code></pre>

<pre><code>6-element Array{Distributions.Normal{Float64},1}:
 Distributions.Normal{Float64}(μ=-2.1, σ=1.5)
 Distributions.Normal{Float64}(μ=-1.3, σ=1.5)
 Distributions.Normal{Float64}(μ=-0.4, σ=1.5)
 Distributions.Normal{Float64}(μ=1.9, σ=1.5)
 Distributions.Normal{Float64}(μ=5.1, σ=1.5)
 Distributions.Normal{Float64}(μ=6.2, σ=1.5)
</code></pre>

<p>Here we see a neat feature of the Julia language. Any Julia function can be vectorized. See <a href="https://julialang.org/blog/2018/05/extensible-broadcast-fusion" target="_blank">this</a> blog post if you want to learn more about this feature. The <code>Normal</code> function above is vectorized by the use of the <code>.</code> operator. This creates an array of Normal distributions. Let&rsquo;s plot each of these distributions:</p>

<pre><code class="language-julia">plot(dists, legend = false)
</code></pre>

<p><img src="/post/2019-03-16-kde-scratch_files/2019-03-16_kde-scratch_4_1.svg" alt="" /></p>

<p>Summing up their probability densities across all of <code>x</code>.</p>

<pre><code class="language-julia">x_d = range(-7, 11, length = 100)
dens = sum(pdf.(eachdist, x_d) for eachdist in dists)

plot!(x_d, dens)
</code></pre>

<p><img src="/post/2019-03-16-kde-scratch_files/2019-03-16_kde-scratch_5_1.svg" alt="" /></p>

<p>The resulting shape of the KDE is identical to the one we first calculated. We could stop here except this is really just a special case where we are using the Normal kernel. Let&rsquo;s go a bit deeper.</p>

<h2 id="kernel-density-from-scratch">Kernel Density from Scratch</h2>

<pre><code class="language-julia">kde(z, ω, xv) =
  sum(@. exp(-0.5 * ((z - xv) / ω)^2) / sqrt(2π*ω^2)) / length(xv)

dens = []
for x_d in range(-7, 10, length = 100)
  push!(dens, kde(x_d, sqrt(2.25), x))
end

plot(dens, legend = false)
</code></pre>

<p><img src="/post/2019-03-16-kde-scratch_files/2019-03-16_kde-scratch_6_1.svg" alt="" /></p>

    </div>

    


<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/julia/">julia</a>
  
</div>




    
      






  







<div class="media author-card" itemscope itemtype="http://schema.org/Person">
  
  
  <img class="portrait mr-3" src="/author/admin/avatar_hu0aa19ccfb82a000d534a4472933defe3_425354_250x250_fill_q90_lanczos_center.jpg" itemprop="image" alt="Avatar">
  

  <div class="media-body">
    <h5 class="card-title" itemprop="name"><a href="/authors/admin">Josh Duncan</a></h5>
    <h6 class="card-subtitle">Business Analyst</h6>
    <p class="card-text" itemprop="description">Just exploring the model space.</p>
    <ul class="network-icon" aria-hidden="true">
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="/#contact" >
          <i class="fas fa-envelope"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://twitter.com/joshualeond" target="_blank" rel="noopener">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
      
      
      
      
        
      
      
      
      
      
        
      
      <li>
        <a itemprop="sameAs" href="https://github.com/joshualeond" target="_blank" rel="noopener">
          <i class="fab fa-github"></i>
        </a>
      </li>
      
    </ul>
  </div>
</div>



      
      
    

    

    


  </div>
</article>

<div class="container">
  <footer class="site-footer">
  
  <p class="powered-by">
    <a href="/privacy/">Privacy Policy</a>
  </p>
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.

    
    <span class="float-right" aria-hidden="true">
      <a href="#" id="back_to_top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

</div>


<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

    

    
    
    
    <script src="/js/mathjax-config.js"></script>
    

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha512-+NqPlbbtM1QqiK8ZAo4Yrj2c4lNQoGv8P79DPtKzj++l5jnN39rHA/xsqn8zE9l0uSoxaCdrOgFs6yjyfbBxSg==" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha256-VsEqElsCHSGmnmHXGQzvoWjWwoznFSZc6hs7ARLRacQ=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" integrity="sha256-X5PoE3KU5l+JcX+w09p/wHl9AzK333C4hJ2I9S5mD4M=" crossorigin="anonymous"></script>

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/r.min.js"></script>
        
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/julia.min.js"></script>
        
      

      
      
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML-full" integrity="sha256-GhM+5JHb6QUzOQPXSJLEWP7R73CbkisjzK5Eyij4U9w=" crossorigin="anonymous" async></script>
      
    

    
    

    
    
    

    
    
    <script>hljs.initHighlightingOnLoad();</script>
    

    
    
    <script>
      const search_index_filename = "/index.json";
      const i18n = {
        'placeholder': "Search...",
        'results': "results found",
        'no_results': "No results found"
      };
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.d7381f2d79e6271d4da28f474f49096c.js"></script>

  
<script src="/js/math-code.js"></script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>


  </body>
</html>

